<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueHour by FliteAxis</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- External JavaScript Libraries -->
    <script src="libs/papaparse.min.js"></script>
    <script src="libs/chart.umd.min.js"></script>
    <script src="libs/html2pdf.bundle.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Landing Screen -->
    <div id="landing-screen" style="display: none;">
        <div class="landing-content">
            <div class="landing-header">
                <img src="images/logo.png" alt="TrueHour by FliteAxis" class="landing-logo">
                <h1>TrueHour by FliteAxis</h1>
                <p>Know What Flying Actually Costs You</p>
            </div>

            <div class="onboarding-options">
                <div class="onboarding-card" role="button" tabindex="0" onclick="OnboardingManager.startManualPath()">
                    <div class="onboarding-icon">üìù</div>
                    <h3>Start Fresh</h3>
                    <p>Enter your flight hours and training goals manually</p>
                </div>

                <div class="onboarding-card" role="button" tabindex="0" onclick="OnboardingManager.startForeFlightPath()">
                    <div class="onboarding-icon">‚úàÔ∏è</div>
                    <h3>Import Logbook</h3>
                    <p>Upload your ForeFlight CSV to auto-fill your hours</p>
                </div>

                <div class="onboarding-card" role="button" tabindex="0" onclick="OnboardingManager.startLoadPath()">
                    <div class="onboarding-icon">üíæ</div>
                    <h3>Load Budget</h3>
                    <p>Continue working on a previously saved budget</p>
                </div>
            </div>

            <div class="landing-footer">
                <button class="btn-link" onclick="OnboardingManager.startSampleData()">
                    Try with sample data
                </button>
                <span style="color: #94a3b8; margin: 0 10px;">‚Ä¢</span>
                <a href="?flow=classic" class="btn-link">Skip to classic view</a>
            </div>
        </div>
    </div>

    <!-- Onboarding Wizard -->
    <div id="onboarding-wizard" style="display: none;">
        <div class="wizard-container">
            <!-- Progress Bar -->
            <div class="wizard-progress">
                <div class="wizard-progress-bar" id="wizard-progress-bar"></div>
            </div>
            <div class="wizard-progress-text" id="wizard-progress-text">Step 1 of 4</div>

            <!-- Wizard Content -->
            <div class="wizard-content">
                <!-- Manual Path - Step 1: Enter Hours -->
                <div id="wizard-step-manual-enter_hours" class="wizard-step" style="display: none;">
                    <h2>Enter Your Current Flight Hours</h2>
                    <p class="wizard-subtitle">If you're just starting, leave these at zero.</p>

                    <div class="wizard-help-tip">
                        <strong>üí° Tip:</strong> These hours help us calculate how much training you have left to reach your certification goals. PIC, XC, and Instrument hours cannot exceed your total flight time.
                    </div>

                    <div class="wizard-form">
                        <div class="input-row">
                            <div class="input-label">Total Flight Time <span style="color: #dc2626;">*</span></div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-total-hours" value="0" min="0" step="0.1" oninput="OnboardingManager.validateHours()">
                                <span class="input-unit">hours</span>
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-label">Pilot in Command (PIC)</div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-pic-hours" value="0" min="0" step="0.1" oninput="OnboardingManager.validateHours()">
                                <span class="input-unit">hours</span>
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-label">Cross Country (XC)</div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-xc-hours" value="0" min="0" step="0.1" oninput="OnboardingManager.validateHours()">
                                <span class="input-unit">hours</span>
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-label">Instrument Time</div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-instrument-hours" value="0" min="0" step="0.1" oninput="OnboardingManager.validateHours()">
                                <span class="input-unit">hours</span>
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-label">Simulator Time (Optional)</div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-simulator-hours" value="0" min="0" step="0.1">
                                <span class="input-unit">hours</span>
                            </div>
                        </div>

                        <div id="wizard-hours-validation" style="display: none; margin-top: 15px; padding: 12px; background: #fee2e2; border: 1px solid #dc2626; border-radius: 8px; color: #991b1b; font-size: 0.9em;"></div>
                    </div>
                </div>

                <!-- Manual Path - Step 2: Add Aircraft -->
                <div id="wizard-step-manual-add_aircraft" class="wizard-step" style="display: none;">
                    <h2>Add Your Training Aircraft</h2>
                    <p class="wizard-subtitle">Add at least one aircraft with rental rates, then continue.</p>

                    <div class="wizard-help-tip">
                        <strong>üí° Tip:</strong> Fill out the form below and click "Save Aircraft" to add it to your list. You can add multiple aircraft if needed.
                    </div>

                    <div class="wizard-form" style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <div class="input-row">
                            <div class="input-label">Aircraft Make <span style="color: #dc2626;">*</span></div>
                            <input type="text" class="input-field" id="wizard-aircraft-make" placeholder="e.g., Cessna">
                        </div>

                        <div class="input-row">
                            <div class="input-label">Aircraft Model <span style="color: #dc2626;">*</span></div>
                            <input type="text" class="input-field" id="wizard-aircraft-model" placeholder="e.g., 172SP">
                        </div>

                        <div class="input-row">
                            <div class="input-label">Tail Number</div>
                            <input type="text" class="input-field" id="wizard-aircraft-registration" placeholder="e.g., N12345 (optional)">
                        </div>

                        <div class="input-row">
                            <div class="input-label">Rate Type <span style="color: #dc2626;">*</span></div>
                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="wizard-rate-type" value="wet" checked onchange="OnboardingManager.toggleWizardRateType()">
                                    <span>Wet Rate (fuel included)</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" name="wizard-rate-type" value="dry" onchange="OnboardingManager.toggleWizardRateType()">
                                    <span>Dry Rate (fuel separate)</span>
                                </label>
                            </div>
                        </div>

                        <div class="input-row" id="wizard-wet-rate-row">
                            <div class="input-label">Wet Rate <span style="color: #dc2626;">*</span></div>
                            <div class="input-wrapper">
                                <span class="input-unit">$</span>
                                <input type="number" class="input-field" id="wizard-aircraft-wet-rate" placeholder="165" min="0">
                                <span class="input-unit">/hour</span>
                            </div>
                        </div>

                        <div class="input-row" id="wizard-dry-rate-row" style="display: none;">
                            <div class="input-label">Dry Rate <span style="color: #dc2626;">*</span></div>
                            <div class="input-wrapper">
                                <span class="input-unit">$</span>
                                <input type="number" class="input-field" id="wizard-aircraft-dry-rate" placeholder="120" min="0">
                                <span class="input-unit">/hour</span>
                            </div>
                        </div>

                        <div class="input-row" id="wizard-fuel-price-row" style="display: none;">
                            <div class="input-label">Fuel Price</div>
                            <div class="input-wrapper">
                                <span class="input-unit">$</span>
                                <input type="number" class="input-field" id="wizard-aircraft-fuel-price" placeholder="6" min="0" step="0.10">
                                <span class="input-unit">/gallon</span>
                            </div>
                        </div>

                        <div class="input-row" id="wizard-fuel-burn-row" style="display: none;">
                            <div class="input-label">Fuel Burn</div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-aircraft-fuel-burn" placeholder="8" min="0" step="0.5">
                                <span class="input-unit">gal/hour</span>
                            </div>
                        </div>

                        <button class="btn-primary" onclick="OnboardingManager.addWizardAircraft()" style="margin-top: 15px; width: 100%;">
                            ‚úì Save Aircraft
                        </button>
                    </div>

                    <div id="wizard-aircraft-list"></div>
                </div>

                <!-- Manual & ForeFlight Path - Certification Selection -->
                <div id="wizard-step-manual-select_cert" class="wizard-step" style="display: none;">
                    <h2>Select Your Certification Goal</h2>
                    <p class="wizard-subtitle">What rating or license are you working toward?</p>

                    <div class="wizard-help-tip">
                        <strong>üí° Tip:</strong> We'll use FAA requirements to calculate how many hours you need and estimate your total cost.
                    </div>

                    <div class="wizard-form">
                        <div class="input-row">
                            <div class="input-label">Target Certification</div>
                            <select class="input-field" id="wizard-cert-select">
                                <option value="">None</option>
                                <option value="ir">Instrument Rating (Part 61)</option>
                                <option value="cpl">Commercial Pilot License (Part 61)</option>
                                <option value="cfi">Certified Flight Instructor</option>
                            </select>
                        </div>

                        <div class="input-row">
                            <div class="input-label">Training Pace</div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-lessons-per-week" value="2" min="1" max="7" step="0.5">
                                <span class="input-unit">lessons/week</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Path - Review -->
                <div id="wizard-step-manual-review" class="wizard-step" style="display: none;">
                    <h2>Review Your Setup</h2>
                    <p class="wizard-subtitle">Everything looks good? Let's calculate your budget!</p>

                    <div class="wizard-review-summary">
                        <div class="review-section">
                            <h3>Flight Hours</h3>
                            <div class="review-item">Total: <strong id="review-total-hours">0</strong> hours</div>
                        </div>

                        <div class="review-section">
                            <h3>Aircraft</h3>
                            <div id="review-aircraft-list"></div>
                        </div>

                        <div class="review-section">
                            <h3>Certification Goal</h3>
                            <div class="review-item" id="review-certification">None selected</div>
                        </div>
                    </div>
                </div>

                <!-- ForeFlight Path - Step 1: Upload CSV -->
                <div id="wizard-step-foreflight-upload_csv" class="wizard-step" style="display: none;">
                    <h2>Upload Your ForeFlight Logbook</h2>
                    <p class="wizard-subtitle">We'll automatically extract your flight hours and aircraft.</p>

                    <div class="wizard-help-tip">
                        <strong>üí° Tip:</strong> Export your logbook from ForeFlight as a CSV file. Go to Logbook ‚Üí Share ‚Üí Export as CSV.
                    </div>

                    <div class="wizard-form">
                        <div class="logbook-import-card" onclick="document.getElementById('wizard-csv-file').click()">
                            <input type="file" id="wizard-csv-file" accept=".csv" style="display: none;" onchange="OnboardingManager.handleCSVUpload(event)">
                            <div class="import-card-content">
                                <div class="import-icon">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </div>
                                <div class="import-text">
                                    <h3>Drop CSV file here</h3>
                                    <p>or click to browse</p>
                                </div>
                            </div>
                        </div>

                        <div id="wizard-csv-status" style="display: none; margin-top: 15px;"></div>
                    </div>
                </div>

                <!-- ForeFlight Path - Step 2: Import Aircraft -->
                <div id="wizard-step-foreflight-import_aircraft" class="wizard-step" style="display: none;">
                    <h2>Select Aircraft to Import</h2>
                    <p class="wizard-subtitle">We found aircraft in your logbook. Select which ones to import.</p>

                    <div class="wizard-help-tip">
                        <strong>üí° Tip:</strong> You'll need to add rental rates for each aircraft you import.
                    </div>

                    <div id="wizard-foreflight-aircraft-list"></div>
                </div>

                <!-- ForeFlight Path - Step 3: Verify Hours -->
                <div id="wizard-step-foreflight-verify_hours" class="wizard-step" style="display: none;">
                    <h2>Verify Your Flight Hours</h2>
                    <p class="wizard-subtitle">We extracted these hours from your logbook. Look correct?</p>

                    <div class="wizard-form">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-label">Total Time</div>
                                <div class="stat-value" id="wizard-verify-total">0.0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">PIC Time</div>
                                <div class="stat-value" id="wizard-verify-pic">0.0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Cross Country</div>
                                <div class="stat-value" id="wizard-verify-xc">0.0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Instrument</div>
                                <div class="stat-value" id="wizard-verify-instrument">0.0</div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="wizard-verify-confirm" style="width: auto;">
                                <span>These hours look correct</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Duplicate cert selection for ForeFlight path -->
                <div id="wizard-step-foreflight-select_cert" class="wizard-step" style="display: none;">
                    <h2>Select Your Certification Goal</h2>
                    <p class="wizard-subtitle">What rating or license are you working toward?</p>

                    <div class="wizard-help-tip">
                        <strong>üí° Tip:</strong> We'll use FAA requirements to calculate how many hours you need and estimate your total cost.
                    </div>

                    <div class="wizard-form">
                        <div class="input-row">
                            <div class="input-label">Target Certification</div>
                            <select class="input-field" id="wizard-cert-select-ff">
                                <option value="">None</option>
                                <option value="ir">Instrument Rating (Part 61)</option>
                                <option value="cpl">Commercial Pilot License (Part 61)</option>
                                <option value="cfi">Certified Flight Instructor</option>
                            </select>
                        </div>

                        <div class="input-row">
                            <div class="input-label">Training Pace</div>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="wizard-lessons-per-week-ff" value="2" min="1" max="7" step="0.5">
                                <span class="input-unit">lessons/week</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ForeFlight Path - Review -->
                <div id="wizard-step-foreflight-review" class="wizard-step" style="display: none;">
                    <h2>Review Your Setup</h2>
                    <p class="wizard-subtitle">Everything looks good? Let's calculate your budget!</p>

                    <div class="wizard-review-summary">
                        <div class="review-section">
                            <h3>Flight Hours (from ForeFlight)</h3>
                            <div class="review-item">Total: <strong id="review-ff-total-hours">0</strong> hours</div>
                        </div>

                        <div class="review-section">
                            <h3>Aircraft</h3>
                            <div id="review-ff-aircraft-list"></div>
                        </div>

                        <div class="review-section">
                            <h3>Certification Goal</h3>
                            <div class="review-item" id="review-ff-certification">None selected</div>
                        </div>
                    </div>
                </div>

                <!-- Load Path - Select File -->
                <div id="wizard-step-load-select_file" class="wizard-step" style="display: none;">
                    <h2>Load a Saved Budget</h2>
                    <p class="wizard-subtitle">Select a previously saved budget file to continue.</p>

                    <div class="wizard-form">
                        <div class="logbook-import-card" onclick="document.getElementById('wizard-load-file').click()">
                            <input type="file" id="wizard-load-file" accept=".json" style="display: none;" onchange="OnboardingManager.handleLoadFile(event)">
                            <div class="import-card-content">
                                <div class="import-icon">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </div>
                                <div class="import-text">
                                    <h3>Drop JSON file here</h3>
                                    <p>or click to browse</p>
                                </div>
                            </div>
                        </div>

                        <div id="wizard-load-status" style="display: none; margin-top: 15px;"></div>
                    </div>
                </div>
            </div>

            <!-- Help Message -->
            <div id="wizard-help-message" class="wizard-help-message" style="display: none;"></div>

            <!-- Navigation -->
            <div class="wizard-navigation">
                <button class="btn-secondary" id="wizard-back-btn" onclick="OnboardingManager.previousStep()">
                    ‚Üê Back
                </button>
                <button class="btn-primary" id="wizard-next-btn" onclick="OnboardingManager.nextStep()">
                    Continue ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="deleteModalTitle">Delete All Data?</h2>
            </div>
            <div class="modal-body">
                <p id="deleteModalMessage"></p>
                <div id="deleteModalInput" style="display: none;">
                    <input type="text" id="deleteConfirmInput" placeholder="Type DELETE to confirm">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="deleteModalCancel">Cancel</button>
                <button class="modal-btn modal-btn-danger" id="deleteModalConfirm">Continue</button>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="header">
            <div class="header-logo-container">
                <img src="images/logo.png" alt="TrueHour by FliteAxis" class="header-logo">
                <div class="header-text">
                    <h1>TrueHour by FliteAxis</h1>
                    <p>Know What Flying Actually Costs You</p>
                </div>
            </div>

            <div class="header-actions">
                <div class="save-status" id="saveStatus"></div>
                <button class="btn-save" id="saveBtn" title="Save to database">
                    <span class="save-icon">üíæ</span>
                    <span class="save-text">Save</span>
                </button>
                <div class="hamburger-menu" id="hamburgerMenu">
                    <div class="hamburger-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <div class="menu-dropdown" id="menuDropdown">
                <div class="menu-item" id="exportConfigBtn">
                    <span class="menu-item-icon">‚¨áÔ∏è</span>
                    <span class="menu-item-text">Export Config</span>
                </div>
                <div class="menu-item" id="loadConfigBtn">
                    <span class="menu-item-icon">‚¨ÜÔ∏è</span>
                    <span class="menu-item-text">Load Config</span>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-section-label">Settings</div>
                <div class="menu-item" id="autoSaveToggle">
                    <span class="menu-item-icon">üîÑ</span>
                    <span class="menu-item-text">Auto-Save: <span id="autoSaveStatus">ON</span></span>
                </div>
                <div class="menu-item-subtext" id="lastSavedText">Last saved: Never</div>
                <div class="menu-divider"></div>
                <div class="menu-item menu-item-danger" id="deleteAllDataBtn">
                    <span class="menu-item-icon">üóëÔ∏è</span>
                    <span class="menu-item-text">Delete All Data</span>
                </div>
                    </div>
                </div>
            </div>

            <input type="file" id="budgetFileInput" class="hidden-file-input" accept=".json">
        </div>

        <!-- Flight Hours & Requirements Widget -->
        <div class="training-progress-widget" id="trainingProgressWidget" style="display: none;">
            <div class="widget-header">
                <div class="widget-title-section">
                    <h2 class="widget-title">Flight Hours & Requirements</h2>
                    <p class="widget-subtitle">Track your hours and certification requirements</p>
                </div>
                <button class="btn-primary" onclick="TrainingWidget.showImportModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Import Logbook
                </button>
            </div>

            <div class="widget-content">
                <!-- Hours Summary Cards -->
                <div class="hours-summary-grid">
                    <div class="hours-card">
                        <div class="hours-card-icon">‚úàÔ∏è</div>
                        <div class="hours-card-content">
                            <div class="hours-card-label">Total Time</div>
                            <div class="hours-card-value" id="widget-total-hours">0.0</div>
                            <div class="hours-card-unit">hours</div>
                        </div>
                    </div>

                    <div class="hours-card">
                        <div class="hours-card-icon">üë®‚Äç‚úàÔ∏è</div>
                        <div class="hours-card-content">
                            <div class="hours-card-label">PIC</div>
                            <div class="hours-card-value" id="widget-pic-hours">0.0</div>
                            <div class="hours-card-unit">hours</div>
                        </div>
                    </div>

                    <div class="hours-card">
                        <div class="hours-card-icon">üó∫Ô∏è</div>
                        <div class="hours-card-content">
                            <div class="hours-card-label">Cross Country</div>
                            <div class="hours-card-value" id="widget-xc-hours">0.0</div>
                            <div class="hours-card-unit">hours</div>
                        </div>
                    </div>

                    <div class="hours-card">
                        <div class="hours-card-icon">‚òÅÔ∏è</div>
                        <div class="hours-card-content">
                            <div class="hours-card-label">Instrument</div>
                            <div class="hours-card-value" id="widget-instrument-hours">0.0</div>
                            <div class="hours-card-unit">hours</div>
                        </div>
                    </div>

                    <div class="hours-card">
                        <div class="hours-card-icon">üåô</div>
                        <div class="hours-card-content">
                            <div class="hours-card-label">Night</div>
                            <div class="hours-card-value" id="widget-night-hours">0.0</div>
                            <div class="hours-card-unit">hours</div>
                        </div>
                    </div>

                    <div class="hours-card">
                        <div class="hours-card-icon">üéÆ</div>
                        <div class="hours-card-content">
                            <div class="hours-card-label">Simulator</div>
                            <div class="hours-card-value" id="widget-sim-hours">0.0</div>
                            <div class="hours-card-unit">hours</div>
                        </div>
                    </div>
                </div>

                <!-- Certification Requirements -->
                <div class="cert-progress-section" id="widget-cert-progress" style="display: none;">
                    <div class="cert-section-header" onclick="TrainingWidget.toggleCertSection()">
                        <h3 class="section-heading">Certification Requirements</h3>
                        <svg class="section-chevron" id="cert-section-chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="cert-section-body expanded" id="cert-section-body">
                        <div class="cert-selector-header">
                            <select id="cert-selector" class="cert-selector-dropdown">
                                <option value="">Select Certification</option>
                                <option value="instrument">Instrument Rating</option>
                                <option value="private" disabled>Private Pilot (Coming Soon)</option>
                                <option value="commercial" disabled>Commercial Pilot (Coming Soon)</option>
                                <option value="cfi" disabled>CFI (Coming Soon)</option>
                            </select>
                        </div>
                        <div class="cert-requirements-container" id="cert-progress-container">
                            <!-- Requirements panels will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Import Info -->
                <div class="widget-import-info" id="widget-import-info" style="display: none;">
                    <div class="import-info-icon">‚ÑπÔ∏è</div>
                    <div class="import-info-content">
                        <div class="import-info-text">
                            <strong>Last Import:</strong> <span id="widget-import-date">Never</span>
                        </div>
                        <div class="import-info-text" id="widget-import-summary">
                            <span id="widget-import-details">No imports yet</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid-layout">
            <div class="panel">
                <h2>1. Plan Your Training</h2>
                <p class="panel-subtitle">Import logbook to see progress. Enter planned hours for remaining training.</p>

                <div class="section-title">Import Your Progress (Optional)</div>

                <div class="logbook-import-card" id="fileUploadArea">
                    <input type="file" id="logbookFile" accept=".csv" style="display: none;">
                    <div class="import-card-content">
                        <div class="import-icon">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </div>
                        <div class="import-text">
                            <h3>Import ForeFlight Logbook</h3>
                            <p>Upload your CSV logbook to see current hours and track progress</p>
                        </div>
                    </div>
                    <button class="btn-import" onclick="document.getElementById('logbookFile').click(); event.stopPropagation();">
                        Choose File
                    </button>
                </div>

                <div class="input-row">
                    <div class="input-label">Certification:</div>
                    <select class="input-field" id="targetCert">
                        <option value="">None</option>
                        <option value="ir">Instrument Rating (Part 61)</option>
                        <option value="cpl">Commercial Pilot License (Part 61)</option>
                        <option value="cfi">Certified Flight Instructor</option>
                    </select>
                </div>

                <div class="section-title">Aircraft Rental Rates</div>

                <!-- Aircraft Selection Dropdown -->
                <div class="input-row">
                    <div class="input-label">Select Aircraft</div>
                    <div style="display: flex; gap: 10px; flex: 1;">
                        <select class="input-field" id="aircraftSelect" style="flex: 1;" onchange="loadSelectedAircraft()">
                            <option value="">-- Select or Add Aircraft --</option>
                        </select>
                        <button class="btn-secondary" onclick="showManageAircraftModal()">Manage</button>
                    </div>
                </div>

                <!-- FAA Lookup Toggle -->
                <div class="input-row" style="padding: 10px; background: #f8fafc; border-radius: 8px; margin-top: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px; font-size: 0.9em;">
                        <input type="checkbox" id="enableFAALookup" onchange="toggleFAALookup()" style="width: auto;" disabled aria-labelledby="faaLookupLabel">
                        <label id="faaLookupLabel" for="enableFAALookup" style="cursor: not-allowed; opacity: 0.5;">
                            <span>Enable FAA Aircraft Lookup (US aircraft only)</span>
                            <span style="display: block; color: #64748b; font-size: 0.85em; margin-top: 2px;">
                                Automatically looks up aircraft details from FAA registry for N-numbers. Data is cached for 24 hours.
                            </span>
                        </label>
                    </div>
                    <div id="faaLookupStatus" style="display: block; margin-top: 8px; padding: 8px; border-radius: 6px; font-size: 0.85em; background: #f1f5f9; color: #64748b; border: 1px solid #cbd5e1;">
                        ‚Ñπ <strong>Checking availability...</strong><br>Verifying if FAA lookup is enabled in this deployment.
                    </div>
                </div>

                <!-- Aircraft Details Form (Hidden until aircraft selected) -->
                <div id="aircraftDetails" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
                    <div class="input-row">
                        <div class="input-label">Aircraft Type</div>
                        <input type="text" class="input-field" id="aircraftType" placeholder="e.g., Cessna 172" oninput="markAircraftDirty()">
                    </div>

                    <div class="input-row">
                        <div class="input-label">Registration (Optional)</div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" class="input-field" id="aircraftRegistration" placeholder="e.g., N12345" oninput="markAircraftDirty()" style="flex: 1;">
                            <button class="btn-secondary" onclick="lookupSingleAircraftFAA()" id="singleLookupButton" style="display: none; white-space: nowrap;">
                                Lookup FAA Data
                            </button>
                        </div>
                    </div>

                    <div id="singleFaaLookupStatus" style="display: none; padding: 12px; border-radius: 6px; margin: 10px 0;"></div>

                    <div class="input-row">
                        <div class="input-label">Make</div>
                        <input type="text" class="input-field" id="aircraftMake" placeholder="e.g., Cessna" oninput="markAircraftDirty()">
                    </div>

                    <div class="input-row">
                        <div class="input-label">Model</div>
                        <input type="text" class="input-field" id="aircraftModel" placeholder="e.g., 172" oninput="markAircraftDirty()">
                    </div>

                    <div class="input-row">
                        <div class="input-label">Year (Optional)</div>
                        <input type="text" class="input-field" id="aircraftYear" placeholder="e.g., 2001" oninput="markAircraftDirty()">
                    </div>

                    <div class="input-row">
                        <div class="input-label">Rate Type</div>
                        <div style="display: flex; gap: 20px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="rateType" value="wet" checked onchange="toggleRateType(); markAircraftDirty();">
                                <span>Wet Rate</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="rateType" value="dry" onchange="toggleRateType(); markAircraftDirty();">
                                <span>Dry Rate</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-row" id="wetRateSection">
                        <div class="input-label">Wet Rate</div>
                        <div class="input-wrapper">
                            <span class="input-unit">$</span>
                            <input type="number" class="input-field" id="aircraftWetRate" placeholder="150" min="0" step="1" oninput="markAircraftDirty()">
                            <span class="input-unit">/hour</span>
                        </div>
                    </div>

                    <div class="input-row" id="dryRateSection" style="display: none;">
                        <div class="input-label">Dry Rate</div>
                        <div class="input-wrapper">
                            <span class="input-unit">$</span>
                            <input type="number" class="input-field" id="aircraftDryRate" placeholder="120" min="0" step="1" oninput="markAircraftDirty()">
                            <span class="input-unit">/hour</span>
                        </div>
                    </div>

                    <div class="input-row" id="fuelPriceSection" style="display: none;">
                        <div class="input-label">Fuel Price</div>
                        <div class="input-wrapper">
                            <span class="input-unit">$</span>
                            <input type="number" class="input-field" id="aircraftFuelPrice" placeholder="6" min="0" step="0.10" oninput="markAircraftDirty()">
                            <span class="input-unit">/gallon</span>
                        </div>
                    </div>

                    <div class="input-row" id="fuelBurnSection" style="display: none;">
                        <div class="input-label">Fuel Burn</div>
                        <div class="input-wrapper">
                            <input type="number" class="input-field" id="aircraftFuelBurn" placeholder="8" min="0" step="0.5" oninput="markAircraftDirty()">
                            <span class="input-unit">gal/hour</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn-primary" onclick="saveCurrentAircraft()" id="saveAircraftBtn">
                            <span id="saveAircraftText">Save Aircraft</span>
                        </button>
                        <button class="btn-secondary" onclick="setAsDefaultAircraft()" id="setDefaultBtn" style="display: none;">
                            ‚òÖ Set as Default
                        </button>
                        <button class="btn-secondary" onclick="deleteCurrentAircraft()" id="deleteAircraftBtn" style="display: none;">
                            Delete Aircraft
                        </button>
                        <button class="btn-secondary" onclick="clearAircraftForm()">
                            Add New Aircraft
                        </button>
                    </div>
                </div>

                <!-- Legacy aircraft list (keeping for backwards compatibility) -->
                <div id="aircraftList" style="display: none;"></div>
                <button class="btn-add" id="addAircraftBtn" style="display: none;">+ Add Aircraft</button>

                <div class="section-title">Financial & Time Planning</div>

                <div class="input-row">
                    <label class="input-label" for="lessonsPerWeek">Training Pace (Lessons per week)</label>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="lessonsPerWeek" name="lessonsPerWeek" value="2" min="1" max="7" step="0.5">
                        <span class="input-unit">lessons/week</span>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; margin-top: 20px; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 0.95em; color: #666; margin-bottom: 8px;">Est. Time to Completion</div>
                        <div style="font-size: 2em; font-weight: 700; color: #1e40af;" id="estimatedMonths">~ 0 Months</div>
                    </div>
                    <div>
                        <div style="font-size: 0.95em; color: #666; margin-bottom: 8px;">Est. Monthly Budget</div>
                        <div style="font-size: 2em; font-weight: 700; color: #1e40af;" id="monthlyBudget">$0.00</div>
                    </div>
                </div>

                <div class="section-title">Other Hourly Rates</div>

                <div class="input-row">
                    <label class="input-label" for="instructorRate">Flight/Ground Instruction</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="instructorRate" name="instructorRate" value="60">
                        <span class="input-unit">per hour</span>
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="simulatorRate">Flight Simulator</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="simulatorRate" name="simulatorRate" value="105">
                        <span class="input-unit">per hour</span>
                    </div>
                </div>

                <div class="section-title">Planned Training Hours</div>

                <div class="input-row">
                    <div class="input-label">Total Dual Hours (Planned)</div>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="dualHours" value="0" readonly>
                        <span class="input-unit">hours</span>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-label">Total Solo Hours (Planned)</div>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="soloHours" value="0" readonly>
                        <span class="input-unit">hours</span>
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="groundHours">Ground Instruction Hours</label>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="groundHours" name="groundHours" value="0">
                        <span class="input-unit">hours</span>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-label">Additional Personal Hours</div>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="familyHours" value="0" readonly>
                        <span class="input-unit">hours</span>
                    </div>
                </div>

                <div class="section-title">Gear & Supplies</div>

                <div class="input-row">
                    <label class="input-label" for="headsetCost">Aviation Headset</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="headsetCost" name="headsetCost" value="0">
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="booksCost">Ground School / Books</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="booksCost" name="booksCost" value="0">
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="bagCost">Flight Supplies</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="bagCost" name="bagCost" value="0">
                    </div>
                </div>

                <div class="section-title">Exams & Fees</div>

                <div class="input-row">
                    <label class="input-label" for="medicalCost">Aviation Medical Exam</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="medicalCost" name="medicalCost" value="300">
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="knowledgeCost">FAA Knowledge Test</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="knowledgeCost" name="knowledgeCost" value="250">
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="checkrideCost">Practical Exam (Checkride)</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="checkrideCost" name="checkrideCost" value="1000">
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="insuranceCost">Renter's Insurance (Annual)</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="insuranceCost" name="insuranceCost" value="1150">
                    </div>
                </div>

                <div class="section-title">Subscriptions (Annual)</div>

                <div class="input-row">
                    <label class="input-label" for="foreflightCost">ForeFlight / EFB</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="foreflightCost" name="foreflightCost" value="275">
                    </div>
                </div>

                <div class="input-row">
                    <label class="input-label" for="onlineSchoolCost">Online Ground School</label>
                    <div class="input-wrapper">
                        <span style="color: #999;">$</span>
                        <input type="number" class="input-field" id="onlineSchoolCost" name="onlineSchoolCost" value="0">
                    </div>
                </div>

                <div class="section-title">Contingency</div>

                <div class="input-row">
                    <label class="input-label" for="contingencyPercent">Contingency Fund (15-25%)</label>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="contingencyPercent" name="contingencyPercent" value="20">
                        <span class="input-unit">%</span>
                    </div>
                </div>
            </div>

            <div>
                <div class="summary-card">
                    <h2>2. Your Training Budget</h2>

                    <div class="summary-row">
                        <div class="summary-label">Flight Training:</div>
                        <div class="summary-value" id="flightTrainingCost">$0.00</div>
                    </div>
                    <div class="summary-row">
                        <div class="summary-label">Personal Flying:</div>
                        <div class="summary-value" id="familyFlightCost">$0.00</div>
                    </div>
                    <div class="summary-row">
                        <div class="summary-label">Gear & Supplies:</div>
                        <div class="summary-value" id="gearCost">$0.00</div>
                    </div>
                    <div class="summary-row">
                        <div class="summary-label">Exams & Fees:</div>
                        <div class="summary-value" id="examsCost">$2,700.00</div>
                    </div>
                    <div class="summary-row">
                        <div class="summary-label">Subscriptions:</div>
                        <div class="summary-value" id="subscriptionsCost">$275.00</div>
                    </div>
                    <div class="summary-row">
                        <div class="summary-label">Subtotal:</div>
                        <div class="summary-value" id="subtotalCost">$2,975.00</div>
                    </div>
                    <div class="summary-row">
                        <div class="summary-label">Contingency Fund:</div>
                        <div class="summary-value" id="contingencyCost">$595.00</div>
                    </div>

                    <div class="total-section">
                        <h3>Total Budget Estimate</h3>
                        <div class="total-amount" id="totalCost">$3,570.00</div>
                        <button class="btn-export" id="exportPdfBtn">Export to PDF</button>
                    </div>
                </div>

                <div id="logbookSummary" class="summary-card" style="display: none;">
                    <h2>Your Current Hours</h2>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">Total Time</div>
                            <div class="stat-value" id="summaryTotalTime">0.0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">PIC Time</div>
                            <div class="stat-value" id="summaryPICTime">0.0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Cross Country</div>
                            <div class="stat-value" id="summaryXCTime">0.0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Dual Received</div>
                            <div class="stat-value" id="summaryDualTime">0.0</div>
                        </div>
                    </div>

                    <div class="collapsible-header" id="instrumentDetailsHeader">
                        <div class="collapsible-title">Instrument Time Details</div>
                        <div class="collapsible-icon" id="instrumentDetailsIcon">‚ñº</div>
                    </div>
                    <div class="collapsible-content" id="instrumentDetails">
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-label">Total Instrument</div>
                                <div class="stat-value" id="summaryInstrumentTime">0.0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Actual</div>
                                <div class="stat-value" id="summaryActualInstrument">0.0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Simulated</div>
                                <div class="stat-value" id="summarySimulatedInstrument">0.0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Simulator</div>
                                <div class="stat-value" id="summarySimTimeContainer"><span id="summarySimTime">0.0</span></div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Instrument Dual</div>
                                <div class="stat-value" id="summaryInstrumentDualAirplane">0.0</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Recent (2mo)</div>
                                <div class="stat-value" id="summaryRecentInstrument">0.0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="budgetBreakdown" class="summary-card">
                    <h2>Budget Breakdown</h2>
                    <div class="chart-container">
                        <canvas id="budgetChart"></canvas>
                    </div>
                    <div class="chart-legend" id="chartLegend"></div>
                </div>

                <div id="requirementsList" class="summary-card" style="display: none;">
                    <h2>Requirements Progress</h2>
                    <div id="requirementsContent"></div>
                </div>
            </div>
        </div>

        <!-- Budget Tracking Section (Spans Full Width) -->
        <div class="panel" style="margin-top: 30px; grid-column: 1 / -1;">
            <h2>3. Budget Tracking</h2>
            <p class="panel-subtitle">Plan your aviation spending with outcome-based budget cards.</p>

            <!-- Budget Summary Cards -->
            <div id="budgetSummary" class="budget-summary-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <!-- Summary cards will be inserted here by budget-cards.js -->
            </div>

            <!-- Budget Actions and Filters -->
            <div class="budget-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                <button id="addBudgetCardBtn" class="btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>Add Budget Card</span>
                </button>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="font-size: 0.9em; color: #64748b;">Filter:</label>
                    <select id="budgetMonthSelector" class="input-field" style="width: auto; min-width: 150px;">
                        <option value="">All Months</option>
                    </select>
                    <select id="budgetYearSelector" class="input-field" style="width: auto; min-width: 120px;">
                        <!-- Year options will be populated by JS -->
                    </select>
                </div>
            </div>

            <!-- Budget Cards List -->
            <div id="budgetCardsList" class="budget-cards-container">
                <!-- Budget cards will be inserted here by budget-cards.js -->
            </div>

            <!-- Legacy Budget List (Hidden by default) -->
            <div id="budgetList" class="budget-list" style="display: none;">
                <!-- Legacy budget cards will be inserted here by budget.js -->
            </div>
        </div>

        <!-- Expense Tracking Section (Spans Full Width) -->
        <div class="panel" style="margin-top: 30px; grid-column: 1 / -1;">
            <h2>4. Expense Tracking</h2>
            <p class="panel-subtitle">Track your aviation expenses and link them to budget cards.</p>

            <!-- Expense Summary Cards -->
            <div id="expenseSummary" class="budget-summary-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <!-- Summary cards will be inserted here by expenses.js -->
            </div>

            <!-- Expense Actions and Filters -->
            <div class="budget-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                <button id="addExpenseBtn" class="btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>Add Expense</span>
                </button>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="font-size: 0.9em; color: #64748b;">Filter:</label>
                    <select id="expenseMonthFilter" class="input-field" style="width: auto; min-width: 150px;">
                        <option value="">All Months</option>
                    </select>
                    <select id="expenseCategoryFilter" class="input-field" style="width: auto; min-width: 150px;">
                        <option value="">All Categories</option>
                        <option value="Fuel">Fuel</option>
                        <option value="Instructor">Instructor</option>
                        <option value="Rental">Rental</option>
                        <option value="Insurance">Insurance</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Subscription">Subscription</option>
                        <option value="Membership">Membership</option>
                        <option value="Supplies">Supplies</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>

            <!-- Expenses List -->
            <div id="expensesList" class="expenses-container">
                <!-- Expenses will be inserted here by expenses.js -->
            </div>
        </div>
    </div>

    <!-- Aircraft Management Modal -->
    <div id="manageAircraftModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Manage Aircraft</h2>
                <button class="modal-close" onclick="closeManageAircraftModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="aircraftManagementList"></div>
                <p style="color: #666; font-size: 0.9em; margin-top: 15px;">
                    <strong>Tip:</strong> Click "Set as Default" to make an aircraft your primary selection.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="showFAARefreshModal()" id="refreshFAAButton" style="display: none;">Refresh FAA Data</button>
                <button class="btn-secondary" onclick="closeManageAircraftModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- FAA Data Refresh Modal -->
    <div id="faaRefreshModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Refresh FAA Data</h2>
                <button class="modal-close" onclick="closeFAARefreshModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">Select aircraft to verify against the FAA registry. Changes will be shown for your review.</p>

                <div id="faaRefreshStatus" style="display: none; padding: 12px; border-radius: 6px; margin-bottom: 15px;"></div>

                <div id="faaRefreshAircraftList" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="performBulkFAARefresh()" id="checkSelectedButton">Check Selected</button>
                <button class="btn-secondary" onclick="closeFAARefreshModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- FAA Data Diff Modal -->
    <div id="faaDiffModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Review FAA Data Changes</h2>
                <button class="modal-close" onclick="closeFAADiffModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="faaDiffContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="applyCurrentFAAChange()">Apply This Change</button>
                <button class="btn-secondary" onclick="skipCurrentFAAChange()">Skip</button>
                <button class="btn-secondary" onclick="closeFAADiffModal()">Cancel All</button>
            </div>
        </div>
    </div>

    <!-- Aircraft Import Prompt Modal -->
    <div id="aircraftImportPromptModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Import Aircraft</h2>
                <button class="modal-close" onclick="closeAircraftImportPrompt()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; line-height: 1.6;">We detected aircraft in your ForeFlight logbook. Would you like to import them to save their rental rates for future calculations?</p>
                <p style="color: #666; font-size: 0.9em; line-height: 1.5;">You'll be able to customize aircraft names, select wet or dry rates, and set rental prices for each one.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="confirmAircraftImport()">Yes, Import Aircraft</button>
                <button class="btn-secondary" onclick="closeAircraftImportPrompt()">No Thanks</button>
            </div>
        </div>
    </div>

    <!-- CSV Aircraft Import Modal -->
    <div id="csvImportModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Import Aircraft from ForeFlight</h2>
                <button class="modal-close" onclick="closeCSVImportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">We found <strong id="csvAircraftCount">0</strong> aircraft in your logbook. Select which ones you'd like to import and set their rental rates.</p>
                <div id="csvAircraftList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="importSelectedAircraft()">Import Selected</button>
                <button class="btn-secondary" onclick="closeCSVImportModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Budget Form Modal (Create/Edit Budget) -->
    <div id="budgetFormModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="budgetFormTitle">Add Budget</h2>
                <button class="modal-close" onclick="BudgetManager.closeModal('budgetFormModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="budgetForm">
                    <div class="form-group">
                        <label for="budgetNameInput">Budget Name <span style="color: #dc2626;">*</span></label>
                        <input type="text" id="budgetNameInput" placeholder="e.g., 2025 PPL Training" required>
                    </div>

                    <div class="form-group">
                        <label for="budgetTypeSelect">Budget Type <span style="color: #dc2626;">*</span></label>
                        <select id="budgetTypeSelect" required>
                            <option value="">-- Select Type --</option>
                            <option value="monthly">Monthly</option>
                            <option value="annual">Annual</option>
                            <option value="goal">Goal-Based</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="budgetAmountInput">Total Amount <span style="color: #dc2626;">*</span></label>
                        <input type="number" id="budgetAmountInput" placeholder="10000" min="0" step="0.01" required>
                        <small>Total budget amount for this period</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="budgetStartDate">Start Date</label>
                            <input type="date" id="budgetStartDate">
                        </div>

                        <div class="form-group">
                            <label for="budgetEndDate">End Date</label>
                            <input type="date" id="budgetEndDate">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="budgetCategoriesInput">Categories (Optional)</label>
                        <select id="budgetCategoriesInput" multiple>
                            <option value="flight_training">Flight Training</option>
                            <option value="aircraft_rental">Aircraft Rental</option>
                            <option value="fuel">Fuel</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="insurance">Insurance</option>
                            <option value="subscriptions">Subscriptions</option>
                            <option value="exams">Exams & Fees</option>
                            <option value="equipment">Equipment</option>
                        </select>
                        <small>Hold Ctrl/Cmd to select multiple. Leave blank to track all expenses.</small>
                    </div>

                    <div class="form-group">
                        <label for="budgetNotesInput">Notes (Optional)</label>
                        <textarea id="budgetNotesInput" placeholder="Optional notes about this budget"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="BudgetManager.closeModal('budgetFormModal')">Cancel</button>
                        <button type="submit" class="btn-primary">Save Budget</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Budget Detail Modal -->
    <div id="budgetDetailModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="budgetName">Budget Details</h2>
                <button class="modal-close" onclick="BudgetManager.closeModal('budgetDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="budget-detail-info">
                    <div class="budget-detail-info-item">
                        <label>Type</label>
                        <span id="budgetType">-</span>
                    </div>
                    <div class="budget-detail-info-item">
                        <label>Date Range</label>
                        <span id="budgetDates">-</span>
                    </div>
                    <div class="budget-detail-info-item">
                        <label>Categories</label>
                        <span id="budgetCategories">All</span>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>Monthly Allocations</h3>
                    <button class="btn-primary btn-sm" onclick="BudgetManager.showEntryModal()">+ Add Month</button>
                </div>

                <table class="budget-entries-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Allocated</th>
                            <th>Actual</th>
                            <th>Difference</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="entriesTbody">
                        <!-- Entries will be inserted here -->
                    </tbody>
                </table>

                <div class="chart-container">
                    <canvas id="budgetDetailChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Budget Entry Modal (Add/Edit Monthly Entry) -->
    <div id="entryFormModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="entryFormTitle">Add Budget Entry</h2>
                <button class="modal-close" onclick="BudgetManager.closeModal('entryFormModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="entryForm">
                    <div class="form-group">
                        <label for="entryMonth">Month <span style="color: #dc2626;">*</span></label>
                        <input type="month" id="entryMonth" required>
                    </div>

                    <div class="form-group">
                        <label for="entryAmount">Allocated Amount <span style="color: #dc2626;">*</span></label>
                        <input type="number" id="entryAmount" placeholder="1000" min="0" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="entryNotes">Notes (Optional)</label>
                        <textarea id="entryNotes" placeholder="Optional notes for this month"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="BudgetManager.closeModal('entryFormModal')">Cancel</button>
                        <button type="submit" class="btn-primary">Save Entry</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Budget Card Form Modal (Create/Edit Budget Card) -->
    <div id="budgetCardFormModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="budgetCardFormTitle">Add Budget Card</h2>
                <button class="modal-close" onclick="BudgetCards.closeCreateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="budgetCardForm">
                    <div class="form-group">
                        <label for="budgetCardName">Budget Name <span style="color: #dc2626;">*</span></label>
                        <input type="text" id="budgetCardName" placeholder="e.g., ACME Flight Club" required>
                        <small>Descriptive name for this budget item</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="budgetCardCategory">Category <span style="color: #dc2626;">*</span></label>
                            <select id="budgetCardCategory" required>
                                <option value="">-- Select Category --</option>
                                <option value="Administrative">Administrative</option>
                                <option value="Training">Training</option>
                                <option value="Family">Family</option>
                                <option value="Maintenance">Maintenance</option>
                                <option value="Insurance">Insurance</option>
                                <option value="Equipment">Equipment</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="budgetCardFrequency">Frequency <span style="color: #dc2626;">*</span></label>
                            <select id="budgetCardFrequency" required>
                                <option value="">-- Select Frequency --</option>
                                <option value="once">One-Time</option>
                                <option value="monthly">Monthly</option>
                                <option value="annual">Annual</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="budgetCardDate">Date <span style="color: #dc2626;">*</span></label>
                            <input type="date" id="budgetCardDate" required>
                            <small>Use first of month for monthly budgets</small>
                        </div>

                        <div class="form-group">
                            <label for="budgetCardAmount">Budgeted Amount <span style="color: #dc2626;">*</span></label>
                            <div class="input-wrapper">
                                <span class="input-unit">$</span>
                                <input type="number" id="budgetCardAmount" placeholder="500" min="0" step="0.01" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="budgetCardHours">Associated Hours (Optional)</label>
                        <div class="input-wrapper">
                            <input type="number" id="budgetCardHours" placeholder="12.0" min="0" step="0.1">
                            <span class="input-unit">hours</span>
                        </div>
                        <small>Training hours associated with this budget</small>
                    </div>

                    <div class="form-group">
                        <label for="budgetCardNotes">Notes (Optional)</label>
                        <textarea id="budgetCardNotes" placeholder="Additional details, breakdown, etc." rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="budgetCardStatus">Status</label>
                        <select id="budgetCardStatus">
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="BudgetCards.closeCreateModal()">Cancel</button>
                        <button type="submit" class="btn-primary">Save Budget Card</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px;"></div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmTitle">Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirmMessage" style="margin: 0; line-height: 1.6;"></p>
            </div>
            <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button id="confirmCancelBtn" class="modal-btn modal-btn-secondary">Cancel</button>
                <button id="confirmOkBtn" class="modal-btn modal-btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Expense Form Modal -->
    <div id="expenseFormModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="expenseFormTitle">Add Expense</h2>
                <button class="modal-close" onclick="ExpenseManager.closeModal('expenseFormModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="expenseForm" onsubmit="event.preventDefault(); ExpenseManager.saveExpense();">
                    <div class="form-group">
                        <label for="expenseCategory">Category <span style="color: #dc2626;">*</span></label>
                        <select id="expenseCategory" required>
                            <option value="">-- Select Category --</option>
                            <option value="Fuel">Fuel</option>
                            <option value="Instructor">Instructor</option>
                            <option value="Rental">Rental</option>
                            <option value="Insurance">Insurance</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Subscription">Subscription</option>
                            <option value="Membership">Membership</option>
                            <option value="Supplies">Supplies</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="expenseDescription">Description</label>
                        <input type="text" id="expenseDescription" placeholder="e.g., 1.5 hour lesson with CFI">
                        <small>Optional notes about this expense</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="expenseAmount">Amount <span style="color: #dc2626;">*</span></label>
                            <input type="number" id="expenseAmount" min="0.01" step="0.01" required placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label for="expenseDate">Date <span style="color: #dc2626;">*</span></label>
                            <input type="date" id="expenseDate" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="expenseVendor">Vendor</label>
                        <input type="text" id="expenseVendor" placeholder="e.g., ACME Flight Club">
                        <small>The business or person you paid</small>
                    </div>

                    <div class="form-group">
                        <label for="expenseSubcategory">Subcategory</label>
                        <input type="text" id="expenseSubcategory" placeholder="Optional">
                        <small>Additional categorization (e.g., "100LL", "Dual Instruction")</small>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="expenseIsRecurring" style="width: auto; margin: 0;">
                            <span>Recurring Expense</span>
                        </label>
                        <small>Check if this expense repeats regularly</small>
                    </div>

                    <div class="form-group" id="recurrenceIntervalGroup" style="display: none;">
                        <label for="expenseRecurrenceInterval">Recurrence Interval</label>
                        <select id="expenseRecurrenceInterval">
                            <option value="">-- Select --</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="annual">Annual</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="expenseIsTaxDeductible" style="width: auto; margin: 0;">
                            <span>Tax Deductible</span>
                        </label>
                        <small>Mark if this expense may be tax deductible</small>
                    </div>

                    <div class="form-group">
                        <label for="expenseBudgetCard">Link to Budget Card (Optional)</label>
                        <select id="expenseBudgetCard">
                            <option value="">-- Don't link now --</option>
                            <!-- Options populated by ExpenseManager.showCreateModal() -->
                        </select>
                        <small>Optionally link this expense to a budget card immediately</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="ExpenseManager.closeModal('expenseFormModal')">Cancel</button>
                        <button type="submit" class="btn-primary">Save Expense</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Budget Link Modal -->
    <div id="budgetLinkModal" class="modal" style="display: none;">
        <!-- Content will be dynamically generated by expenses.js -->
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-container">
            <div class="footer-left">
                <span>¬© <span id="currentYear"></span> FliteAxis. All Rights Reserved.</span>
            </div>
            <div class="footer-right">
                <a href="https://fliteaxis.com/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
                <a href="https://fliteaxis.com/terms" target="_blank" rel="noopener noreferrer">Terms of Service</a>
            </div>
        </div>
    </footer>

    <!-- Application JavaScript -->
    <script>
        // Set current year
        document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>
    <script src="js/aircraft-lookup.js"></script>
    <script src="js/aircraft-api.js"></script>
    <script src="js/aircraft-ui.js"></script>
    <script src="js/user-data.js"></script>
    <script src="js/expenses.js"></script>
    <script src="js/budget.js"></script>
    <script src="js/budget-cards.js"></script>
    <script src="js/training-widget.js"></script>
    <script src="js/app.js"></script>
    <script src="js/onboarding.js"></script>
</body>
</html>
