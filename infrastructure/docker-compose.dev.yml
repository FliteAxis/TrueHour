version: '3.8'

# Development override - use with:
# docker-compose -f infrastructure/docker-compose.yml -f infrastructure/docker-compose.dev.yml up

services:
  api:
    build:
      context: ../backend
      dockerfile: Dockerfile
      target: development
    volumes:
      - ../backend/app:/app/app:ro  # Hot reload for code changes
      - ../data:/app/config
    environment:
      - DATABASE_URL=postgresql://truehour:truehour@db:5432/truehour
      - CONFIG_PATH=/app/config/config.json
      - RELOAD=true  # Enable uvicorn auto-reload
    command: ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

  db:
    ports:
      - "5432:5432"  # Expose for local DB tools
